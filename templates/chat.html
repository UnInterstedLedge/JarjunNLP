<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Select a Speaker</title>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<div class="chat-container">
    <h1>Who do you want to talk to?</h1>
    <form method="post" action="{{ url_for('index') }}">
        <select name="speaker" id="speaker-selection">
            <option value="">--Please choose an option--</option>
            <option value="ben_shapiro" {{ 'selected' if selected_speaker == 'ben_shapiro' else '' }}>Ben Shapiro</option>
            <option value="joe_biden" {{ 'selected' if selected_speaker == 'joe_biden' else '' }}>Joe Biden</option>
            <option value="morgan_freeman" {{ 'selected' if selected_speaker == 'morgan_freeman' else '' }}>Morgan Freeman</option>
            <option value="donald_trump" {{ 'selected' if selected_speaker == 'donald_trump' else '' }}>Donald Trump</option>
        </select>
        <input type="text" name="user_input" placeholder="Say 'Hi' to start talking" autofocus>
        <button id="mic-button" type="button">
            <img src="{{ url_for('static', filename='images/microphone.png') }}" alt="Microphone" style="width: 24px; height: 24px;">
        </button>
        <button type="submit">Talk</button>
    </form>
    <div class="speaker-image">
        <!-- Image tag only with alt attribute to prevent "None image" text -->
        <img id="speaker-img" alt="" style="display:none; width: 300px; height: auto;">
    </div>
    {% if response %}
        <p>Response: {{ response }}</p>
    {% endif %}
</div>

<script>
// Define the paths to images as JavaScript variables
var benShapiroImage = "{{ url_for('static', filename='images/benshapiro.jpg') }}";
var joeBidenImage = "{{ url_for('static', filename='images/joe_biden.jpg') }}";
var morganFreemanImage = "{{ url_for('static', filename='images/morgan_freeman.jpg') }}";
var donaldTrumpImage = "{{ url_for('static', filename='images/donald_trump.jpg') }}";

document.getElementById('speaker-selection').addEventListener('change', function() {
    var speakerImg = document.getElementById('speaker-img');
    var speakerName = this.value;
    var imagePath = {
        'ben_shapiro': benShapiroImage,
        'joe_biden': joeBidenImage,
        'morgan_freeman': morganFreemanImage,
        'donald_trump': donaldTrumpImage
    };
    // Check if speakerName has a valid selection and update the image source
    if (imagePath[speakerName]) {
        speakerImg.src = imagePath[speakerName];
        speakerImg.alt = speakerName.split('_').join(' ') + ' image';
        speakerImg.style.display = 'block';
    } else {
        speakerImg.src = '';
        speakerImg.alt = '';
        speakerImg.style.display = 'none';
    }

    // Clear the response text when changing the selection
    var responseParagraph = document.querySelector('.chat-container p');
    if (responseParagraph) {
        responseParagraph.style.display = 'none';
    }
});

// JavaScript for the microphone input
var recognition = new webkitSpeechRecognition();
recognition.continuous = false;
recognition.lang = 'en-US';
recognition.interimResults = false;
recognition.maxAlternatives = 1;

document.getElementById('mic-button').onclick = function() {
    recognition.start();
};

recognition.onresult = function(event) {
    var speechResult = event.results[0][0].transcript;
    document.getElementsByName('user_input')[0].value = speechResult;
};

recognition.onspeechend = function() {
    recognition.stop();
};

recognition.onerror = function(event) {
    console.error('Speech recognition error detected: ' + event.error);
};

// Ensure the image and response are reset when the page loads
document.addEventListener('DOMContentLoaded', function() {
    var selectedSpeaker = "{{ selected_speaker }}";
    var speakerImg = document.getElementById('speaker-img');
    // Check if there's a previously selected speaker and update the image source
    if (selectedSpeaker && selectedSpeaker !== 'None') {
        speakerImg.src = {
            'ben_shapiro': benShapiroImage,
            'joe_biden': joeBidenImage,
            'morgan_freeman': morganFreemanImage,
            'donald_trump': donaldTrumpImage
        }[selectedSpeaker] || '';
        speakerImg.alt = selectedSpeaker.split('_').join(' ') + ' image';
        speakerImg.style.display = 'block';
    }
});
</script>

</body>
</html>
